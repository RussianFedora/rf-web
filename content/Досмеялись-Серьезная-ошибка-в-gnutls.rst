.. title: Досмеялись. Серьезная ошибка в GnuTLS.
.. slug: Досмеялись-Серьезная-ошибка-в-gnutls
.. date: 2014-03-05 01:06:48
.. tags:
.. category:
.. link:
.. description:
.. type: text
.. author: Peter Lemenkov

**Это архивная статья**


Совсем недавно OSS-энтузиасты весело радовались серьезному проколу
компании Apple, `в результате которого SSL-соединения стали уязвимы к
атакам MiTM <https://www.imperialviolet.org/2014/02/22/applebug.html>`__
(хотя были и мнения, что это не прокол, а `осознанное вредительство в
рамках программ NSA <http://rt.com/usa/apple-nsa-ios-exploit-693/>`__).

Так вот, зря радовались.

Есть такая криптобиблиотека - GnuTLS, мэйнтейнером которой является
инженер Red Hat, `Nikos
Mavrogiannopoulos <https://www.openhub.net/accounts/nmav>`__. Ее
используют такие известные приложения, как emacs + email/nntp, wget,
vlc, network-manager, mutt, empathy и многие другие. Просто попробуйте
удалить ее с помощью *sudo yum remove gnutls* и вы поймете ее важность.

И вот, в феврале инженер Red Hat, Suman Jana, нашел (и `предложил патч
для
исправления <https://www.gitorious.org/gnutls/gnutls/commit/b1abfe3d18>`__)
удивительную ошибку в GnuTLS - `промежуточные сертификаты приравнивались
к корневым <https://access.redhat.com/security/cve/CVE-2014-1959>`__.

Оказалось не очень страшно, и проявляется лишь в ряде частных случаев. И
вроде уже все успокоились, как тут
`внезапно <https://lurkmore.to/Внезапно>`__ обнаружили что в старой
линейке RHEL 5.x `есть похожая
ошибка <https://access.redhat.com/security/cve/CVE-2009-5138>`__,
впервые опубликованная еще в 2009 году. А потом Nikos обнаружил еще
более значительную дыру - `GnuTLS не возвращает ошибку в ряде случаев
проверки сертификата, а успешно завершает
валидацию <https://bugzilla.redhat.com/1069865>`__, причем дыра
существует с 2005 года. Oops!
Патчи, конечно, уже есть -
`раз <https://www.gitorious.org/gnutls/gnutls/commit/855127d>`__,
`два <https://www.gitorious.org/gnutls/gnutls/commit/a79aed2>`__,
`три <https://www.gitorious.org/gnutls/gnutls/commit/6aa26f7>`__, и Red
Hat `отрапортовал о выходе исправления для RHEL 5.x и RHEL
6.x <https://bugzilla.redhat.com/1069865>`__, но учитывая сложность
обновления серверных систем (не все еще используют виртуализацию и
облака, гордясь большим аптаймом физических машин) уязвимость будет
присутствовать на множестве машин.

Проблема, кстати, очень показательна. Это и зоопарк несовместимых, под
разными лицензиями, и плохо пересекающихся по функционалу
криптобиблиотек, чья `консолидация идет очень
тяжело <https://fedoraproject.org/wiki/FedoraCryptoConsolidation>`__.

Это и то, что исправить ошибку такого масштаба реалистично лишь в случае
динамической линковки, и без bundled libs, о проблемах с которыми `пишут
регулярно <https://www.opennet.ru/opennews/art.shtml?num=38533>`__, в
т.ч. и `наши
участники </content/bundled-libraries-немного-статистики-и-комментариев-к-ней>`__.

Это и недостаток рабочих рук при разработке фундаментальных библиотек,
занимаются которыми ведет всего лишь несколько компаний. Но главное, это
то, что не стоит раньше времени хихикать над проприетарными продуктами.

Как бы потом над нами не посмеялись.

На ArsTechnica `уже проводят параллели с багом
Apple <http://arstechnica.com/security/2014/03/critical-crypto-bug-leaves-linux-hundreds-of-apps-open-to-eavesdropping/>`__.

