.. title: SELinux больше не будет пугать пользователей, запускающих Windows-программы в Wine
.. slug: selinux-больше-не-будет-пугать-пользователей-запускающих-windows-программы-в-wine
.. date: 2014-03-13 00:05:23
.. tags:
.. category:
.. link:
.. description:
.. type: text
.. author: Peter Lemenkov

**Это архивная статья**


SELinux обычно вызывает проблемы лишь с откровенно глючным ПО, и чаще
всего люди жалуются, что он блокирует Skype, Flash и Windows-программы в
Wine. Из этого перечня видно, что SELinux работает правильно! К
сожалению, среди глючных Windows-программ, запускаемых в Wine,
попадаются и игры. Некоторые пользователи довольно разумно говорят, что
глючную игру можно раз в пару часов и перезапустить - чай не Emacs, и не
хотелось бы чтоб SELinux ее блокировал. `Dan
Walsh <http://people.redhat.com/dwalsh/>`__ прислушался к таким
пользователям.

Dan `объявил <http://danwalsh.livejournal.com/69035.html>`__, что
`DAC-проверки <https://ru.wikipedia.org/wiki/Избирательное_управление_доступом>`__
для случая mmap\_zero будут выполняться перед `проверками
MAC <https://ru.wikipedia.org/wiki/Мандатное_управление_доступом>`__
(`патч <http://thread.gmane.org/gmane.comp.security.selinux/20251>`__
был предложен инженером Red Hat, Paul Moore). Раньше программа под Wine
зачастую пыталась mmap-ить память начиная с адреса меньшего, чем
разрешенное пороговое значение в /proc/sys/vm/mmap\_min\_addr , что у
нее, разумеется, не получалось. Для программы это было некритично - она
просто повторяла попытку с увеличенным адресом. Проблема в том, что
проводилась и MAC, и DAC проверки, в результате чего логи засыпались
сообщениями вида ***SELinux is preventing /usr/bin/wine-preloader from
'mmap\_zero' accesses on the memprotect***, пугавшими пользователя.

Теперь будет проводиться сначала DAС-проверка, и только если она успешно
прошла, будет проверка MAC (самого SELinux). Таким образом MAC-проверки
для пользовательских приложений вообще не потребуется, т.к. DAC вернет
ошибочное значение EPERM. Проверка MAC будет проводиться только для тех
приложений, что запущены от суперпользователя (прошедшие DAC).

Заодно Dan рассказал про интересную историю, которая произошла недавно.

`У одного из заказчиков Red Hat не запускались Web-приложения для
OpenShift со смонтированной с nosuid
партиции <http://danwalsh.livejournal.com/68723.html>`__, и Dan
описывает как он решал эту проблему. Обратите внимание, какой уровень
поддержки оказала компания, раз проблема была поднята непосредственно
для разработчика подсистемы ядра. Так-то!
