.. title: Новости X.org - DRM2, DRI3 (DRI-Next), EGL, отказ от GLX
.. slug: Новости-xorg-drm2-dri3-dri-next-egl-отказ-от-glx
.. date: 2012-10-01 00:15:41
.. tags:
.. category:
.. link:
.. description:
.. type: text
.. author: Peter Lemenkov

**Это архивная статья**


После прошедшей конференции
`XDC2012 <http://www.x.org/wiki/Events/XDC2012>`__, организованной SUSE,
на которой присутствовали и наши друзья по Fedora Project, разработчики
X.org начали работу над довольно радикальными нововведениями, о которых
хотелось бы рассказать.

Для начала, инженер NVIDIA, Andy Ritger `предложил изменить ABI OpenGL в
Linux <http://thread.gmane.org/gmane.comp.video.mesa3d.devel/45835>`__,
и его предложение было встречено с большим энтузиазмом. Оно
стандартизирует разделение на Vendor-independent и Vendor-dependent
части OpenGL, что позволит легче устанавливать различные реализации
OpenGL параллельно. Сейчас любая реализация обязана предоставлять
библиотеку с заранее заданным названием - *%{\_libdir}/libGL.so.1*, что
естественным образом приводит к различным конфликтам при апдейтах -
представляю, сколько головной боли это создает инженерам NVIDIA с их
проприетарным блобом.

Это предложение естественным образом перетекло в обсуждение того, как бы
попроще перейти с GLX на EGL? Инфраструктурная проблема с GLX в том, что
на самой популярной Linux-платформе, т.е. Android, она лишняя. Там нужен
OpenGL ES (а его проще всего реализовывать через EGL) и никогда не будет
никакого GLX, т.к. не используется X-сервер. Wayland также изначально
работает с EGL, а не с GLX. Это приводит к тому, что разработчикам нужно
поддерживать и GLX, и EGL, что становится все тяжелее. Техническая-же
проблема с ним в том, что он требует "indirect rendering" (т.е.
выполняться будет с помощью X-сервера), а эта функциональность будет
вскоре удалена в пользу "direct rendering" с помощью DRI. Инженеры Intel
уже рекомендуют ориентироваться на возможности EGL, а не GLX. Популярный
проприетарный вариант Unix от Apple так-же не предоставляет GLX, зато в
нем есть EGL (EAGL). Интересно, что `оказалось очень легко переходить
(например с OpenGL ES) на
EGL <https://github.com/omcfadde/dante/pull/26>`__, что и сделали
разработчики KDE. Они начали перевод KWin с GLX на EGL, `и уже готовы
продемонстрировать
результат <http://blog.martin-graesslin.com/blog/2012/09/who-needs-glx-kwin-does-not/>`__.

Пока в KWin по умолчанию будет GLX, но это уже серьезный шаг вперед, в
т.ч.и к полной независимости от X-сервера (читай, `к переходу KDE на
Wayland <http://blog.martin-graesslin.com/blog/2012/09/a-real-update-on-the-progress-of-wayland-in-kwin-and-kde/>`__).

Помимо этого был обсужден `DRI3 /
DRI-Next <http://keithp.com/blogs/DRI-Next/>`__, в котором наконец-то
будут внесены улучшения безопасности, исправления синхронизации (в т.ч.
касающиеся и Wayland) и переход на использование DMA-BUF. Предложенное
`более года назад
DRI2Video <http://thread.gmane.org/gmane.comp.freedesktop.xorg.devel/24010>`__
(которое выкинет в мусорку еще один первобытный костыль для X11,
XVideo), скорее всего тоже пойдет в DRI3.

И в последнюю очередь, но, конечно, не последним по значимости, хотелось
бы отметить предложенный стандарт DRM2 - в нем основное внимание уделили
вопросу безопасности, и `уже начали поступать
патчи <http://thread.gmane.org/gmane.comp.video.dri.devel/74519>`__,
реализующие предложенное. Проблема с текущим DRM в том, что любой
локальный пользователь имеет доступ разделяемым буферам всех X-серверов
в системе, даже не имея прав доступа к самим серверам (что фатально для
Multi-Seat конфигураций, например). Как и всегда - `прилепили к порочной
архитектуре костыль, который оказалось непросто
исправить </content/Переключающаяся-графика-скоро-в-linux>`__.

Ожидается, что `с переходом на
kmscon </content/Идет-работа-по-удалению-виртуальных-терминалов-из-ядра-configvtn>`__
и с помощью SELinux эта лазейка будет закрыта окончательно.

Что-то давно `не было новостей об
OpenCL </content/Текущий-статус-и-планы-на-opencl-в-fedora>`__, что
немного разочаровывает. Будем ждать.

И напоследок - фотка. Эти великие люди не ноют по форумам, а
предпочитают программировать, и об ошибках сообщают в bug-tracker, а не
в твиттер:
|image0|
Найди себя, %username%.

.. |image0| image:: http://www.phoronix.net/image.php?id=xdc_2012_nue&image=xorg_xdc2012_00_show&w=1920
   :width: 800px
   :height: 531px
