.. title: RPM выбирает бэкенд для хранения данных
.. slug: rpm-vybiraet-bekend-dlia-khraneniia-dannykh
.. date: 2017-07-11 18:18:55 UTC+03:00
.. tags: rpm, sqlite, lmdb, openldap
.. category: Fedora Changes
.. link: 
.. description: 
.. type: text
.. author: Peter Lemenkov

Долгое время для хранения служебных данных в RPM использовалась `BerkleyDB
<https://en.wikipedia.org/wiki/Berkeley_DB>`_. Это довольно старое ПО, да еще и
с неудобной лицензией (AGPL, начиная с версии 6.x). Заменить BDB планировали давно, и `даже написали NDB
<https://github.com/rpm-software-management/rpm/commit/b50d2ad>`_,
экспериментальный бэкенд, который и включили в RPM версии 4.13.

Начиная с RPM 4.14, который `будет фичей Fedora 27
<https://fedoraproject.org/wiki/Changes/RPM-4.14>`_, разработчики планируют
переключиться на новый бэкенд. Как всегда бывает, мало кто увидел, что
изменение внесено уже пару лет назад, и реальное обсуждение началось лишь
сейчас.

Довольно очевидны проблемы - апгрейд будет требовать изменения самой базы
данных, вероятно "сломается" некоторое стороннее ПО. Но главное - на GitHub
лежит туча встраиваемых KV-хранилищ, транзакционных баз данных, реляционных баз
данных, и простых data store. Зачем при таком богатстве выбора создавать что-то
новое?

Сразу поступили предложения пересмотреть решение и использовать `SQLite
<https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/message/UC6UNIMXPGQMRZVN6F6WQQLYWQKQQMLB/>`_
или `LMDB
<https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/message/3QMUR7R5N6UDU2I377OLNFDDV64KQOHI/>`_
- самые напрашивающиеся варианты. Это, конечно, далеко не полный список.

По поводу библиотеки SQLite - интересно то, что такой бэкенд в RPM был, но `его
удалили <https://github.com/rpm-software-management/rpm/commit/e2c217b>`_, мол,
был медленный. Скорее всего, дело было в низком качестве самого бэкенда, и в
том, что вряд ли кто-то использовал SQL-функциональность библиотеки.

По поводу же LMDB - `был только RFE
<https://github.com/rpm-software-management/rpm/issues/128>`_, а не PR.
Реального кода никто еще не предложил, хоть заявленные характеристики
библиотеки и превосходят ожидания. Однако, мы знаем, что разработчики LMDB (они
же разработчики OpenLDAP) - `люди уникальные
<https://www.linux.org.ru/news/opensource/12462568#comment-12471476>`_. Наш
товарищ, Леонид Юрьев, по неизвестной причине уже который год с коллегами
убирается в этих Агиевых конюшнях, для чего, помимо всего, пришлось `форкнуть
LMDB <https://github.com/ReOpen/libmdbx>`_. Мы желаем им удачи, разумеется, но
также нужно признать, что когда он начинает перечислять проблемы в стоковой LMDB,
становится понятно, что просто так в RPM это брать нельзя.

Обсуждение только началось, и посмотрим, чем все закончится.
